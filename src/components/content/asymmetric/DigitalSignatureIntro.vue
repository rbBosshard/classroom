<template>
  <section class="mb-12">
    <div class="bg-purple-50 border-2 border-purple-400 rounded-lg p-6">
      <h2 class="text-3xl font-bold text-purple-900 mb-4">
        ‚úÖ Die L√∂sung:
        <a
          href="https://de.wikipedia.org/wiki/Digitale_Signatur"
          target="_blank"
          rel="noopener noreferrer"
          class="hover:text-blue-800 underline"
        >
          Digitale Signaturen
        </a>
      </h2>

      <div class="bg-white rounded-lg p-5 mb-6 shadow-md">
        <p class="text-lg text-purple-900 mb-3">
          Um das Authentifizierungsproblem zu l√∂sen, brauchen wir einen Weg zu beweisen:
          <strong>"Diese Nachricht wurde wirklich von Alice erstellt!"</strong>
        </p>
        <p class="text-purple-800">
          Die L√∂sung: <strong>Digitale Signaturen</strong> ‚Äì das digitale √Ñquivalent einer
          handschriftlichen Unterschrift, aber viel sicherer! Asymmetrische Schl√ºsselpaare machen es
          m√∂glich!
        </p>
      </div>

      <!-- Wie funktioniert's? -->
      <div class="bg-white rounded-lg p-6 shadow-lg mb-6">
        <h3 class="text-2xl font-semibold text-purple-900 mb-4">
          ‚úçÔ∏è Wie funktioniert eine digitale Signatur?
        </h3>

        <div class="space-y-5">
          <!-- Schritt 1: Signieren (kompakt) -->
          <div
            class="bg-purple-50 rounded-lg p-5 border-l-4 border-purple-500 hover:shadow-md transition-shadow cursor-pointer"
            @click="step1Expanded = !step1Expanded"
          >
            <div class="flex items-start gap-3">
              <div class="text-2xl font-bold text-purple-700 min-w-[2rem]">1Ô∏è‚É£</div>
              <div class="flex-1">
                <h4 class="text-lg font-semibold text-purple-900 mb-2 flex items-center gap-2">
                  Alice signiert
                  <span class="text-sm text-purple-600">{{ step1Expanded ? '‚ñº' : '‚ñ∂' }}</span>
                </h4>
                <p class="text-purple-800 mb-2">
                  Mit ihrem <strong>privaten Schl√ºssel</strong> erzeugt Alice die Signatur.
                </p>
                <div
                  class="bg-white rounded-lg p-4 mt-3 shadow-sm hover:shadow-md transition-shadow"
                >
                  <div class="flex items-center gap-3 text-sm flex-wrap">
                    <span
                      class="font-mono bg-gray-100 px-3 py-2 rounded hover:bg-gray-200 transition-colors"
                      >üìÑ Nachricht</span
                    >
                    <span class="text-purple-600 font-bold">+</span>
                    <span
                      class="font-mono bg-purple-100 px-3 py-2 rounded hover:bg-purple-200 transition-colors"
                      >üîê Private Key</span
                    >
                    <span class="text-purple-600 font-bold">‚Üí</span>
                    <span
                      class="font-mono bg-purple-200 px-3 py-2 rounded font-bold hover:bg-purple-300 transition-colors"
                      >‚úçÔ∏è Signatur</span
                    >
                  </div>
                </div>
                <div v-if="step1Expanded" class="mt-3 bg-purple-100 rounded-lg p-3 animate-fadeIn">
                  <p class="text-purple-800 text-sm">
                    üí° <strong>Technisch im Detail:</strong> Die Nachricht wird zuerst durch eine
                    Hash-Funktion (z.B. SHA-256) geschickt. Der Hash ist wie ein eindeutiger
                    "Fingerabdruck" der Nachricht. Dieser Hash wird dann mit dem privaten Schl√ºssel
                    verschl√ºsselt ‚Äì das Ergebnis ist die Signatur!
                  </p>
                </div>
              </div>
            </div>
          </div>

          <!-- Schritt 2: √úbertragen (kompakt) -->
          <div
            class="bg-purple-50 rounded-lg p-5 border-l-4 border-purple-500 hover:shadow-md transition-shadow cursor-pointer"
            @click="step2Expanded = !step2Expanded"
          >
            <div class="flex items-start gap-3">
              <div class="text-2xl font-bold text-purple-700 min-w-[2rem]">2Ô∏è‚É£</div>
              <div class="flex-1">
                <h4 class="text-lg font-semibold text-purple-900 mb-2 flex items-center gap-2">
                  Senden
                  <span class="text-sm text-purple-600">{{ step2Expanded ? '‚ñº' : '‚ñ∂' }}</span>
                </h4>
                <p class="text-purple-800">
                  Alice schickt <strong>Nachricht</strong> und <strong>Signatur</strong> an Bob.
                </p>
                <div
                  class="bg-white rounded-lg p-4 mt-3 shadow-sm hover:shadow-md transition-shadow"
                >
                  <div class="flex items-center justify-center gap-4 text-sm flex-wrap">
                    <span class="font-semibold text-purple-900">üë©‚Äçüíª Alice</span>
                    <span class="text-2xl animate-pulse">‚Üí</span>
                    <div class="flex flex-col gap-1">
                      <span
                        class="font-mono bg-gray-100 px-2 py-1 rounded text-xs hover:bg-gray-200 transition-colors"
                        >üìÑ Nachricht</span
                      >
                      <span
                        class="font-mono bg-purple-200 px-2 py-1 rounded text-xs hover:bg-purple-300 transition-colors"
                        >‚úçÔ∏è Signatur</span
                      >
                    </div>
                    <span class="text-2xl animate-pulse">‚Üí</span>
                    <span class="font-semibold text-purple-900">üßë‚Äçüíª Bob</span>
                  </div>
                </div>
                <div v-if="step2Expanded" class="mt-3 bg-purple-100 rounded-lg p-3 animate-fadeIn">
                  <p class="text-purple-800 text-sm">
                    üåê <strong>Wichtig:</strong> Die Nachricht selbst ist NICHT verschl√ºsselt ‚Äì
                    jeder kann sie lesen! Die Signatur beweist nur, dass sie von Alice kommt und
                    nicht ver√§ndert wurde. F√ºr Vertraulichkeit br√§uchte man zus√§tzlich
                    Verschl√ºsselung.
                  </p>
                </div>
              </div>
            </div>
          </div>

          <!-- Schritt 3: Verifizieren (kompakt) -->
          <div
            class="bg-purple-50 rounded-lg p-5 border-l-4 border-purple-500 hover:shadow-md transition-shadow cursor-pointer"
            @click="step3Expanded = !step3Expanded"
          >
            <div class="flex items-start gap-3">
              <div class="text-2xl font-bold text-purple-700 min-w-[2rem]">3Ô∏è‚É£</div>
              <div class="flex-1">
                <h4 class="text-lg font-semibold text-purple-900 mb-2 flex items-center gap-2">
                  Bob pr√ºft
                  <span class="text-sm text-purple-600">{{ step3Expanded ? '‚ñº' : '‚ñ∂' }}</span>
                </h4>
                <p class="text-purple-800 mb-2">
                  Bob pr√ºft die Signatur mit Alice‚Äô <strong>√∂ffentlichem Schl√ºssel</strong>.
                </p>
                <div
                  class="bg-white rounded-lg p-4 mt-3 shadow-sm hover:shadow-md transition-shadow"
                >
                  <div class="flex items-center gap-3 text-sm flex-wrap">
                    <span
                      class="font-mono bg-purple-200 px-3 py-2 rounded hover:bg-purple-300 transition-colors"
                      >‚úçÔ∏è Signatur</span
                    >
                    <span class="text-purple-600 font-bold">+</span>
                    <span
                      class="font-mono bg-purple-100 px-3 py-2 rounded hover:bg-purple-200 transition-colors"
                      >üîì Public Key</span
                    >
                    <span class="text-purple-600 font-bold">‚Üí</span>
                    <span
                      class="font-mono bg-green-100 px-3 py-2 rounded font-bold hover:bg-green-200 transition-colors"
                      >‚úÖ G√ºltig / ‚ùå Ung√ºltig</span
                    >
                  </div>
                </div>
                <div v-if="step3Expanded" class="mt-3 bg-purple-100 rounded-lg p-3 animate-fadeIn">
                  <p class="text-purple-800 text-sm">
                    üîç <strong>So funktioniert's:</strong> Bob entschl√ºsselt die Signatur mit Alice'
                    √∂ffentlichem Schl√ºssel und erh√§lt den Hash. Dann berechnet er selbst den Hash
                    der Nachricht. Stimmen beide Hashes √ºberein ‚Üí ‚úÖ g√ºltig! Unterscheiden sie sich
                    ‚Üí ‚ùå manipuliert oder falsche Absenderin!
                  </p>
                </div>
              </div>
            </div>
          </div>

          <!-- Ergebnis -->
          <div
            class="bg-gradient-to-r from-purple-100 to-green-100 rounded-lg p-5 border-l-4 border-purple-600 shadow-md"
          >
            <div class="flex items-start gap-3">
              <div class="text-2xl min-w-[2rem]">‚úÖ</div>
              <div class="flex-1">
                <h4 class="text-lg font-semibold text-purple-900 mb-2">Ergebnis</h4>
                <p class="text-purple-800 mb-2">
                  Wenn die Signatur g√ºltig ist und der √∂ffentliche Schl√ºssel zum Verifizieren der
                  Signatur wirklich zu Alice geh√∂rt, weiss Bob:
                </p>
                <ul class="list-none space-y-2">
                  <li class="bg-white rounded-lg p-3 hover:shadow-md transition-shadow">
                    <span class="text-green-600 font-bold">‚úì</span>
                    <strong class="text-purple-900">Authentizit√§t:</strong>
                    <span class="text-purple-800">
                      Die Nachricht stammt wirklich von Alice (nur sie hat den privaten Schl√ºssel)
                    </span>
                  </li>
                  <li class="bg-white rounded-lg p-3 hover:shadow-md transition-shadow">
                    <span class="text-green-600 font-bold">‚úì</span>
                    <strong class="text-purple-900">Integrit√§t:</strong>
                    <span class="text-purple-800">
                      Die Nachricht wurde nicht ver√§ndert (sonst w√§re die Signatur ung√ºltig)
                    </span>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Was k√∂nnte schiefgehen? -->
      <div class="bg-red-50 border-2 border-red-300 rounded-lg p-5 mb-6">
        <h3 class="text-xl font-semibold text-red-900 mb-3">ü§î Was k√∂nnte schiefgehen?</h3>

        <div class="space-y-3">
          <details class="bg-white rounded-lg p-4">
            <summary class="cursor-pointer text-red-800 font-semibold hover:text-red-600">
              K√∂nnte Mallory eine gef√§lschte Signatur erstellen?
            </summary>
            <p class="mt-3 text-red-700 text-sm">
              <strong>Nein!</strong> Mallory br√§uchte dazu Alice' privaten Schl√ºssel. Ohne den kann
              Mallory zwar eine Signatur erstellen, aber sie w√ºrde nicht als "von Alice kommend"
              verifiziert werden, wenn Bob sie mit Alice' √∂ffentlichem Schl√ºssel pr√ºft.
            </p>
          </details>

          <details class="bg-white rounded-lg p-4">
            <summary class="cursor-pointer text-red-800 font-semibold hover:text-red-600">
              K√∂nnte Mallory die Nachricht √§ndern?
            </summary>
            <p class="mt-3 text-red-700 text-sm">
              <strong>Ja, aber...</strong> Mallory k√∂nnte die Nachricht abfangen und √§ndern. ABER:
              Die Signatur w√ºrde dann nicht mehr passen! Bob w√ºrde sofort merken, dass die Nachricht
              manipuliert wurde (ung√ºltige Verifizierung mit dem √∂ffentlichen Schl√ºssel). Die
              Signatur funktioniert nur mit der originalen Nachricht.
            </p>
          </details>
        </div>
      </div>

      <!-- Verschl√ºsselung vs. Signatur -->

      <!-- Aufgabe: L√ºckentext Verschl√ºsselung vs. Signatur -->
      <div class="bg-blue-50 rounded-lg p-6 shadow-lg mb-6">
        <h3 class="text-xl font-semibold text-blue-900 mb-4">
          üìù Aufgabe: Asymmetrische Verschl√ºsselung vs. digitale Signatur
        </h3>

        <p class="text-blue-800 mb-4">
          Beide Konzepte nutzen asymmetrische Schl√ºsselpaare, aber auf
          <strong>umgekehrte Weise</strong>.<br />
          W√§hle die passenden Begriffe aus den Optionen aus und vervollst√§ndige die L√ºcken:
        </p>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
          <!-- Verschl√ºsselung L√ºckentext -->
          <div class="bg-white rounded-lg p-4 border-2 border-green-300">
            <div class="flex items-center gap-2 mb-3">
              <span class="text-2xl">üîê</span>
              <h4 class="font-semibold text-green-900">Verschl√ºsselung</h4>
            </div>
            <div class="space-y-2 text-sm text-green-800">
              <p>
                <strong>Verschl√ºsseln:</strong> mit
                <select
                  v-model="answers.encryptKey"
                  class="bg-green-100 rounded px-2 py-1 font-mono border border-green-300"
                  :class="{
                    'border-red-500 border-2': showResult && answers.encryptKey !== 'Public Key',
                  }"
                >
                  <option value="">--W√§hle--</option>
                  <option>Public Key</option>
                  <option>Private Key</option>
                </select>
                (von
                <select
                  v-model="answers.encryptPerson"
                  class="bg-green-100 rounded px-2 py-1 border border-green-300"
                  :class="{
                    'border-red-500 border-2': showResult && answers.encryptPerson !== 'Bob',
                  }"
                >
                  <option value="">--W√§hle--</option>
                  <option>Bob</option>
                  <option>Alice</option>
                </select>
                )
              </p>
              <p>
                <strong>Entschl√ºsseln:</strong> mit
                <select
                  v-model="answers.decryptKey"
                  class="bg-green-100 rounded px-2 py-1 font-mono border border-green-300"
                  :class="{
                    'border-red-500 border-2': showResult && answers.decryptKey !== 'Private Key',
                  }"
                >
                  <option value="">--W√§hle--</option>
                  <option>Public Key</option>
                  <option>Private Key</option>
                </select>
                (von
                <select
                  v-model="answers.decryptPerson"
                  class="bg-green-100 rounded px-2 py-1 border border-green-300"
                  :class="{
                    'border-red-500 border-2': showResult && answers.decryptPerson !== 'Bob',
                  }"
                >
                  <option value="">--W√§hle--</option>
                  <option>Bob</option>
                  <option>Alice</option>
                </select>
                )
              </p>
              <p class="italic text-green-700 mt-2">
                ‚Üí Ziel:
                <select
                  v-model="answers.encryptGoal"
                  class="bg-green-100 rounded px-2 py-1 border border-green-300"
                  :class="{
                    'border-red-500 border-2':
                      showResult && answers.encryptGoal !== 'Vertraulichkeit',
                  }"
                >
                  <option value="">--W√§hle--</option>
                  <option>Vertraulichkeit</option>
                  <option>Authentizit√§t</option>
                </select>
                (nur der Empf√§nger Bob kann lesen)
              </p>
            </div>
          </div>

          <!-- Signatur L√ºckentext -->
          <div class="bg-white rounded-lg p-4 border-2 border-purple-300">
            <div class="flex items-center gap-2 mb-3">
              <span class="text-2xl">‚úçÔ∏è</span>
              <h4 class="font-semibold text-purple-900">Digitale Signatur</h4>
            </div>
            <div class="space-y-2 text-sm text-purple-800">
              <p>
                <strong>Signieren:</strong> mit
                <select
                  v-model="answers.signKey"
                  class="bg-purple-100 rounded px-2 py-1 font-mono border border-purple-300"
                  :class="{
                    'border-red-500 border-2': showResult && answers.signKey !== 'Private Key',
                  }"
                >
                  <option value="">--W√§hle--</option>
                  <option>Private Key</option>
                  <option>Public Key</option>
                </select>
                (von
                <select
                  v-model="answers.signPerson"
                  class="bg-purple-100 rounded px-2 py-1 border border-purple-300"
                  :class="{
                    'border-red-500 border-2': showResult && answers.signPerson !== 'Alice',
                  }"
                >
                  <option value="">--W√§hle--</option>
                  <option>Alice</option>
                  <option>Bob</option>
                </select>
                )
              </p>
              <p>
                <strong>Verifizieren:</strong> mit
                <select
                  v-model="answers.verifyKey"
                  class="bg-purple-100 rounded px-2 py-1 font-mono border border-purple-300"
                  :class="{
                    'border-red-500 border-2': showResult && answers.verifyKey !== 'Public Key',
                  }"
                >
                  <option value="">--W√§hle--</option>
                  <option>Public Key</option>
                  <option>Private Key</option>
                </select>
                (von
                <select
                  v-model="answers.verifyPerson"
                  class="bg-purple-100 rounded px-2 py-1 border border-purple-300"
                  :class="{
                    'border-red-500 border-2': showResult && answers.verifyPerson !== 'Alice',
                  }"
                >
                  <option value="">--W√§hle--</option>
                  <option>Alice</option>
                  <option>Bob</option>
                </select>
                )
              </p>
              <p class="italic text-purple-700 mt-2">
                ‚Üí Ziel:
                <select
                  v-model="answers.signGoal"
                  class="bg-purple-100 rounded px-2 py-1 border border-purple-300"
                  :class="{
                    'border-red-500 border-2': showResult && answers.signGoal !== 'Authentizit√§t',
                  }"
                >
                  <option value="">--W√§hle--</option>
                  <option>Authentizit√§t</option>
                  <option>Vertraulichkeit</option>
                </select>
                (beweist: Nachricht von Alice)
              </p>
            </div>
          </div>
        </div>

        <!-- Buttons und Feedback -->
        <div class="flex flex-wrap gap-3 mb-4">
          <button
            class="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-2 rounded-lg transition-colors"
            @click="checkAnswers"
          >
            ‚úì √úberpr√ºfen
          </button>
          <button
            class="bg-green-600 hover:bg-green-700 text-white font-semibold px-6 py-2 rounded-lg transition-colors"
            @click="showSolution"
          >
            üí° L√∂sung anzeigen
          </button>
          <button
            class="bg-gray-500 hover:bg-gray-600 text-white font-semibold px-6 py-2 rounded-lg transition-colors"
            @click="resetAnswers"
          >
            ‚Üª Zur√ºcksetzen
          </button>
        </div>

        <!-- Feedback -->
        <div v-if="showResult" class="mt-4">
          <div
            v-if="isCorrect"
            class="bg-green-100 border-2 border-green-500 rounded-lg p-4 flex items-start gap-3"
          >
            <span class="text-2xl">‚úÖ</span>
            <div>
              <p class="font-bold text-green-900 mb-1">Perfekt! Alle Antworten sind richtig!</p>
              <p class="text-green-800 text-sm">
                Du hast den Unterschied zwischen Verschl√ºsselung und digitaler Signatur verstanden.
                Bei der Verschl√ºsselung nutzt man den
                <strong>Public Key des Empf√§ngers</strong> (Bob), bei der Signatur den
                <strong>Private Key des Absenders</strong> (Alice).
              </p>

              <div>
                <p class="mt-6 text-green-900 font-semibold mb-1">‚úÖ Kombination:</p>
                <p class="text-green-800 text-sm">
                  In der Praxis verwendet man oft <strong>beides</strong>: Verschl√ºsselung f√ºr
                  Vertraulichkeit + Digitale Signatur f√ºr Authentizit√§t. So erreicht man maximale
                  Sicherheit!
                </p>
              </div>
            </div>
          </div>
          <div
            v-else
            class="bg-red-100 border-2 border-red-500 rounded-lg p-4 flex items-start gap-3"
          >
            <span class="text-2xl">‚ùå</span>
            <div>
              <p class="font-bold text-red-900 mb-1">
                Noch nicht ganz richtig. ({{ correctCount }}/8 korrekt)
              </p>
              <p class="text-red-800 text-sm">
                Falsche Antworten sind rot markiert. Tipp: √úberlege, wer was
                verschl√ºsseln/entschl√ºsseln bzw. signieren/verifizieren kann. Nur der Besitzer des
                Private Keys kann damit arbeiten!
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- √úberleitung zu PKI -->
      <div
        class="bg-gradient-to-r from-purple-100 to-green-100 rounded-lg p-5 border-2 border-purple-300"
      >
        <p class="text-lg text-purple-900 font-semibold mb-2">üéØ Zwischenfazit</p>
        <p class="text-purple-800 mb-3">
          Digitale Signaturen l√∂sen das <strong>Authentifizierungsproblem</strong> ‚Äì wir k√∂nnen
          jetzt beweisen, wer eine Nachricht erstellt hat. Aber es bleibt noch eine Frage:
        </p>
        <div class="bg-yellow-50 border-2 border-yellow-400 rounded-lg p-4">
          <p class="text-yellow-900 font-semibold mb-1">‚ùì Die letzte Herausforderung:</p>
          <p class="text-yellow-800">
            <strong
              >Wie kann sich Bob sicher sein, dass ein √∂ffentlicher Schl√ºssel wirklich zu Alice
              geh√∂rt, den Bob zum Verifizieren von Alices Signatur verwendet?</strong
            >
          </p>
        </div>
        <p class="text-purple-800 mt-3">
          Die Antwort darauf liefert die <strong>Public Key Infrastructure (PKI)</strong> mit
          Zertifikaten und Certificate Authorities... (Trent l√§sst gr√ºssen) üëá
        </p>
      </div>
    </div>
  </section>
</template>

<script setup lang="ts">
import { ref, computed, type Ref } from 'vue';

interface Answers {
  encryptKey: string;
  encryptPerson: string;
  decryptKey: string;
  decryptPerson: string;
  encryptGoal: string;
  signKey: string;
  signPerson: string;
  verifyKey: string;
  verifyPerson: string;
  signGoal: string;
}

// Expandable steps state
const step1Expanded = ref(false);
const step2Expanded = ref(false);
const step3Expanded = ref(false);

// Antworten der Sch√ºler
const answers: Ref<Answers> = ref({
  encryptKey: '',
  encryptPerson: '',
  decryptKey: '',
  decryptPerson: '',
  encryptGoal: '',
  signKey: '',
  signPerson: '',
  verifyKey: '',
  verifyPerson: '',
  signGoal: '',
});

// Richtige Antworten
const correctAnswers: Answers = {
  encryptKey: 'Public Key',
  encryptPerson: 'Bob',
  decryptKey: 'Private Key',
  decryptPerson: 'Bob',
  encryptGoal: 'Vertraulichkeit',
  signKey: 'Private Key',
  signPerson: 'Alice',
  verifyKey: 'Public Key',
  verifyPerson: 'Alice',
  signGoal: 'Authentizit√§t',
};

const showResult = ref(false);

// Pr√ºfe, ob alle Antworten korrekt sind
const isCorrect = computed(() => {
  return Object.keys(correctAnswers).every(
    key => answers.value[key as keyof Answers] === correctAnswers[key as keyof Answers]
  );
});

// Z√§hle korrekte Antworten
const correctCount = computed(() => {
  return Object.keys(correctAnswers).filter(
    key => answers.value[key as keyof Answers] === correctAnswers[key as keyof Answers]
  ).length;
});

// √úberpr√ºfe Antworten
const checkAnswers = () => {
  showResult.value = true;
};

// Zeige L√∂sung
const showSolution = () => {
  answers.value = { ...correctAnswers };
  showResult.value = true;
};

// Setze alles zur√ºck
const resetAnswers = () => {
  answers.value = {
    encryptKey: '',
    encryptPerson: '',
    decryptKey: '',
    decryptPerson: '',
    encryptGoal: '',
    signKey: '',
    signPerson: '',
    verifyKey: '',
    verifyPerson: '',
    signGoal: '',
  };
  showResult.value = false;
};
</script>

<style scoped>
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.animate-fadeIn {
  animation: fadeIn 0.3s ease-out;
}
</style>
